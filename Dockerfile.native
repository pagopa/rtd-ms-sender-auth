FROM ghcr.io/graalvm/native-image:ol8-java17-22@sha256:3210af2c1bdf6a73cd82092909e5ed4674ef09caa1b32f2b05db7f232aba72f2 AS builder

WORKDIR /build
COPY . .

RUN ./mvnw clean package -Pnative -DskipTests

FROM alpine:3.18.2@sha256:82d1e9d7ed48a7523bdebc18cf6290bdb97b82302a8a9c27d4fe885949ea94d1 AS runtime

EXPOSE 8080

RUN useradd --uid 10000 runner
USER 10000

COPY --from=builder /build/target/rtd-ms-sender-auth .

ENTRYPOINT ["./rtd-ms-sender-auth"]